<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="HosMapper">

	<insert id="insertHosReview">
		INSERT INTO H_REVIEW_TBL 
		VALUES(H_SEQ_NO.NEXTVAL, #{ hNo }, #{ uId }, #{ hRContent }, DEFAULT, DEFAULT, DEFAULT)
	</insert>
	
	<update id="updateHosReview">
		UPDATE H_REVIEW_TBL 
		   SET H_R_CONTENT = #{ hRContent }, H_R_UPDATE = DEFAULT 
		 WHERE H_R_NO = #{ hRNo }
	</update>
	
	<update id="deleteHosReview">
		UPDATE H_REVIEW_TBL 
		   SET H_R_UPDATE = DEFAULT, H_R_STATUS = 'N' 
		 WHERE H_R_NO = #{ hRNo } 
	</update>
	
	<update id="updateXYtoLatLng">
		UPDATE HOSPITAL_TBL 
		   SET H_LAT = #{ hLat }, H_LNG = #{ hLng } 
		 WHERE H_NO = #{ hNo }
	</update>
	
	<select id="selectOneByhNo" resultType="Hospital">
		SELECT * 
		  FROM HOSPITAL_TBL
		 WHERE H_NO = #{ hNo }  
	</select>
	
	<select id="selectFiveHos" resultType="Hospital">
		<![CDATA[
			SELECT *
			FROM (
			    SELECT
			        HOSPITAL_TBL.*
			        , (6371.0 * ACOS(  
			          COS( ( #{ hLat } / 57.29577951308232087679815481410517033235 ) ) * COS( ( H_LAT / 57.29577951308232087679815481410517033235 ) )
			          * COS( ( H_LNG / 57.29577951308232087679815481410517033235 ) - ( #{ hLng } / 57.29577951308232087679815481410517033235 ) )
			          +
			          SIN( ( #{ hLat } / 57.29577951308232087679815481410517033235 ) ) * SIN( ( H_LAT / 57.29577951308232087679815481410517033235 ) )        
			         )) AS distance
			    FROM HOSPITAL_TBL
			    WHERE H_STATUS = '정상'
			    AND H_X IS NOT NULL
			    ORDER BY distance
			)
			WHERE ROWNUM <= 5
		]]>
	</select>
	
	<select id="selectFiveByKeyword" resultType="Hospital">
		<![CDATA[
			SELECT *
			FROM (
			    SELECT
			        HOSPITAL_TBL.*
			        , (6371.0 * ACOS(  
			          COS( ( #{ hLat } / 57.29577951308232087679815481410517033235 ) ) * COS( ( H_LAT / 57.29577951308232087679815481410517033235 ) )
			          * COS( ( H_LNG / 57.29577951308232087679815481410517033235 ) - ( #{ hLng } / 57.29577951308232087679815481410517033235 ) )
			          +
			          SIN( ( #{ hLat } / 57.29577951308232087679815481410517033235 ) ) * SIN( ( H_LAT / 57.29577951308232087679815481410517033235 ) )        
			         )) AS distance
			    FROM HOSPITAL_TBL
			    WHERE H_STATUS = '정상'
			    AND H_X IS NOT NULL
			    AND ( H_NAME LIKE '%' || #{ hSearchKeyword } || '%' 
			        OR H_ADDR LIKE '%' || #{ hSearchKeyword } || '%' 
			        OR H_ROAD_ADDR LIKE '%' || #{ hSearchKeyword } || '%' )
			    ORDER BY distance
			)
			WHERE ROWNUM <= 5
		]]>
	</select>
	
	<select id="selectAllList" resultType="Hospital">
		SELECT *
		  FROM HOSPITAL_TBL
	</select>
</mapper>